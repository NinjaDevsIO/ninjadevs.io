/*! EnlighterJS TinyMCE Plugin 3.1.0 | The MIT License (X11) | http://enlighterjs.org */
!function(){"use strict";var e=window.console||{},t=(e.error?e.error.bind(e):null)||function(){};if("undefined"==typeof EnlighterJS_EditorConfig)return void t("No EnlighterJS Config found");if("undefined"==typeof tinymce)return void t("TinyMCE not loaded");var n=tinymce,i=EnlighterJS_EditorConfig,l=function(e,t){var l=function(t){return"PRE"==t.nodeName&&e.dom.hasClass(t,"EnlighterJSRAW")},a=function(t){return"CODE"==t.nodeName&&e.dom.hasClass(t,"EnlighterJSRAW")},o=function(t){return("CODE"==t.nodeName||"PRE"==t.nodeName)&&e.dom.hasClass(t,"EnlighterJSRAW")},r=function(e){var t=[{text:"Default (Global-Settings)",value:null}];return n.each(e,function(e,n){t.push({text:n,value:e.toLowerCase()})}),t},d=r(i.languages),g=r(i.themes),u={open:function(t,n){t.onsubmit=n,e.windowManager.open(t)}},s={show:function(t,n){s.hide();var i=e.dom.create("div",{id:"EnlighterToolbar","data-mce-bogus":"1",contenteditable:!1}),l=e.dom.create("div",{"class":"editicon","data-mce-bogus":"1",contenteditable:!1});i.appendChild(l),e.dom.bind(i,"mousedown",function(e){e.stopPropagation(),n()}),e.getBody().appendChild(i);var a=e.dom.getRect(t);e.dom.setStyles(i,{top:a.y,left:a.x,width:a.w})},hide:function(){var t=e.dom.get("EnlighterToolbar");t&&e.dom.remove(t)}},c=function(e,t){return{title:"Enlighter Code Settings",minWidth:700,body:[{type:"listbox",name:"language",label:"Language",values:d,value:e.language,style:"direction: ltr; text-align: left"},{type:"listbox",name:"theme",label:"Theme",values:g,value:e.theme,style:"direction: ltr; text-align: left"},{type:"checkbox",name:"linenums",label:"Show Linenumbers",checked:e.linenumbers,disabled:t},{type:"textbox",name:"highlight",label:"Point out Lines (e.g. 1,2-6,9)",multiline:!1,value:e.highlight,disabled:t,style:"direction: ltr; text-align: left"},{type:"textbox",name:"offset",label:"Linennumber offset (e.g. 5)",multiline:!1,value:e.lineoffset,disabled:t,style:"direction: ltr; text-align: left"},{type:"textbox",name:"group",label:"Codegroup Identifier",multiline:!1,value:e.group,disabled:t,style:"direction: ltr; text-align: left"},{type:"textbox",name:"title",label:"Codegroup Title",multiline:!1,value:e.title,disabled:t,style:"direction: ltr; text-align: left"}]}},h=function(){return{title:"Enlighter Code Insert",minWidth:700,body:[{type:"listbox",name:"lang",label:"Language",values:d,style:"direction: ltr; text-align: left"},{type:"listbox",name:"mode",label:"Mode",values:[{text:"Block-Code",value:"block"},{text:"Inline-Code",value:"inline"}],value:"block",style:"direction: ltr; text-align: left"},{type:"checkbox",name:"indentation",label:"Left-Align Indentation",checked:i.config.indent>0,disabled:i.config.indent<0},{type:"checkbox",name:"addspaces",label:"Surround with spaces",checked:!1,disabled:!1},{type:"textbox",name:"code",label:"Sourcecode",multiline:!0,minHeight:200,style:"direction: ltr; text-align: left"}]}},m=function(){u.open(h(),function(t){var l=t.data.code.replace(/\r\n/gim,"\n"),a="inline"==t.data.mode?"code":"pre";if("block"==t.data.mode&&t.data.indentation){l=l.replace(/^(\t*)/gim,function(e,t,n,l){return new Array(i.config.indent*t.length+1).join(" ")});for(var o=99999,r=l.split("\n"),d=0;d<r.length;d++){var g=r[d];if(g.replace(/\s*/,"").length>0){var u=g.match(/^( *)/gim);if(!u||1!=u.length){o=0;break}o=Math.min(u[0].length,o)}}if(o>0&&99999>o){var s=new RegExp("^( ){"+o+"}","gmi");l=l.replace(s,"")}}l=n.html.Entities.encodeAllRaw(l);var c=t.data.addspaces?"&nbsp;":"";e.insertContent(c+"<"+a+' class="EnlighterJSRAW" data-enlighter-language="'+t.data.lang+'">'+l+"</"+a+">"+c+"<p></p>")})},f=function(t){var n=e.selection.getNode();if(o(n)){var l=function(e){t[e]?n.setAttribute("data-enlighter-"+e,t[e]):n.removeAttribute("data-enlighter-"+e)};l("language"),l("theme"),l("highlight"),l("lineoffset"),l("group"),l("title"),t.linenumbers==i.config.linenumbers?n.removeAttribute("data-enlighter-linenumbers"):n.setAttribute("data-enlighter-linenumbers",t.linenumbers?"true":"false")}},b=function(){var t=e.selection.getNode();if(!o(t))return{};var n=t.getAttribute("data-enlighter-linenumbers");return{language:t.getAttribute("data-enlighter-language"),linenumbers:null==n?i.config.linenumbers:"true"==n,highlight:t.getAttribute("data-enlighter-highlight"),lineoffset:t.getAttribute("data-enlighter-lineoffset"),theme:t.getAttribute("data-enlighter-theme"),group:t.getAttribute("data-enlighter-group"),title:t.getAttribute("data-enlighter-title")}},p=function(){var t=b(),n=a(e.selection.getNode());u.open(c(t,n),function(e){f({language:e.data.language,linenumbers:e.data.linenums,highlight:e.data.highlight,lineoffset:e.data.offset,theme:e.data.theme,title:e.data.title,group:e.data.group})})},v=!1;e.on("PastePreProcess",function(e){v&&(e.stopPropagation(),e.content=e.content.replace(/^\s*<pre(.*?)>([\s\S]+)<\/pre>\s*$/gi,"$2").replace(/\n/g,"<BR/>").replace(/ /g,"&nbsp;").replace(/<span(.*?)>/g,"").replace(/<\/span>/g,""))});var x=null;e.on("NodeChange",function(t){t.stopPropagation();var n=e.selection.getNode();l(n)?(s.show(n,p),v=!0):(s.hide(),v=!1),x&&(o(n)?x.disabled(!1):x.disabled(!0))}),e.addButton("EnlighterInsert",{title:"Enlighter Code Insert",image:t+"/code-insert-icon.png",onclick:m}),e.addButton("EnlighterEdit",{title:"Enlighter Code Settings",disabled:!0,image:t+"/code-edit-icon.png",onPostRender:function(){x=this},onclick:p})};n.PluginManager.add("enlighterjs",l)}();